@using Microsoft.AspNetCore.Http
@inject IHttpContextAccessor HttpContextAccessor


<div class="home-container">
    <!-- ---------------
        Navbar - 1
    ---------------------- -->
    <header>
        <partial name="_Navbar_1" />
        <div class="home-nav1-end"></div>
        <!-- ------------------
            Navbar - 2
        -------------------- -->
        <div class="home-navbar-2">
            <div class="home-nav2-left">
                <label><img src="/images/search.png" alt="" /></label>
                <input type="text" placeholder="Search mission..." name="searchTerm" id="searchText" />
            </div>
            <div class="home-nav2-right">
                <div class="partition"></div>
                <div class="selection">
                    <ul class="navbar-nav">
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown"
                               aria-expanded="false" style="color: #333333">
                                Country
                            </a>
                            <ul class="dropdown-menu mission-Countrys" id="mission-countries">
                            </ul>
                        </li>
                    </ul>
                </div>
                <div class="partition"></div>
                <div class="selection">
                    <ul class="navbar-nav">
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown"
                               aria-expanded="false" style="color: #333333">
                                City
                            </a>
                            <ul class="dropdown-menu mission-Cities" id="mission-cities">
                            </ul>
                        </li>
                    </ul>
                </div>
                <div class="partition"></div>
                <div class="selection">
                    <ul class="navbar-nav">
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown"
                               aria-expanded="false" style="color: #333333">
                                Theme
                            </a>
                            <ul class="dropdown-menu mission-Theme" id="mission-theme">
                            </ul>
                        </li>
                    </ul>
                </div>
                <div class="partition"></div>
                <div class="selection">
                    <ul class="navbar-nav">
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown"
                               aria-expanded="false" style="color: #333333">
                                Skills
                            </a>
                            <ul class="dropdown-menu mission-Skill" id="mission-skill">
                            </ul>
                        </li>
                    </ul>
                </div>
                <div class="partition"></div>
            </div>
        </div>
        <div class="home-nav2-end"></div>
    </header>
    <!---------------------
              Chips
    -------------------------- -->
    <div class="home-chips">
        <div class="chips d-flex flex-wrap" style="gap:1vw;">
            @* <div class="chip">
                Tree Plantation
                <span class="closebtn" onclick="this.parentElement.style.display='none'">&times;</span>
                </div>
                <div class="chip">
                Canada
                <span class="closebtn" onclick="this.parentElement.style.display='none'">&times;</span>
                </div>*@
        </div>
        <a class="close-chips d-none" href="#">Clear All</a>
    </div>
    <!-----------------------
            Heading
    -------------------------- -->
    <div class="home-heading">
        <div class="heading-left">
            <p>Explore <span> missions</span></p>
        </div>
        <div class="heading-right">
            <div class="selections">
                <ul class="navbar-nav">
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false"
                           style="color: #333333">
                            Sort by
                        </a>
                        <ul class="dropdown-menu" id="sort-menu">
                            <li><a class="dropdown-item" >Newest</a></li>
                            <li><a class="dropdown-item" >Oldest</a></li>
                            <li><a class="dropdown-item" >Lowest Seats</a></li>
                            <li><a class="dropdown-item" >Highest Seats</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
            <div class="images">
                <div class="circle-bg-img switch-view">
                    <a style="cursor: pointer;" id="select-grid-style"><img src="/images/grid.png" alt="" /></a>
                </div>
                <a style="cursor: pointer;" id="select-list-style"><img src="/images/list.png" alt="" /></a>
            </div>
        </div>
    </div>

    <!-- ------------
        Grid View
    ---------------- -->
    <div class="grid-view container">
        <div class="grid-items" id="grid-items"></div>
    </div>

    <!-- ------------
        List View
    ---------------- -->

    <div class="listmain-2 mx-auto">
        <div class="container-fluid d-flex align-items-center justify-content-center">
            <div id="mission-list" class="mt-5 p-0">
                @*<partial name="_List"/>*@
            </div>
        </div>
    </div>
    <!-- ------------
        Pagination
      ---------------- -->
   
    <footer>
        <div class="Footer container">
            <div class="Footer-left">
                <p>This website makes use of cookies to enhance browsing experience & provide additional functionality.</p>
                <a href="#">Privacy Policy</a>
            </div>
            <div class="Footer-right">
                <button>I Agree</button>
            </div>
        </div>
    </footer>





    <script>

            $(document).ready(function () {
                 loadCard(null, 1);
                 //loadList();
                 $("#searchText").on("keyup", function(e) {
                    loadCard();
                 })
                 var sortColumn = "";
                 $("#sort-menu li a").on("click", function(e){
                      sortColumn = $(this).text();
                      loadCard(sortColumn, 1);
                 })
            });

        
        function loadCard(sortColumn, paging){

            if(!paging)
                paging = 1;
            var countryIds = [];
            var cityIds  = [];
            var themeIds  = [];
            var skillIds  = [];
            var searchText = $("#searchText").val();
              

            $(".chip").each(function(){
                if($(this).is(':visible')){
                    if($(this).attr('data-filter-type')=='country')
                        countryIds.push($(this).attr('data-id'))
                    else if($(this).attr('data-filter-type')=='city')
                        cityIds.push($(this).attr('data-id'))
                    else if($(this).attr('data-filter-type')=='theme')
                        themeIds.push($(this).attr('data-id'))
                    else if($(this).attr('data-filter-type')=='skill')
                        skillIds.push($(this).attr('data-id'))
                }
            })

            $.ajax({
            type: "POST",
            url: "@Url.Action("gridSP","Mission")",
            dataType: "html",
            cache: false,
            data:{country:countryIds.toString(), city: cityIds.toString(), theme: themeIds.toString(), skill: skillIds.toString(), search: searchText, sortBy: sortColumn, pageNumber: paging},
            success: function (data) {
                //console.warn(data);
                $("#grid-items").html("");
                $('#grid-items').html(data);
            },
            error: function (xhr, status, error) {
                // Handle error
                console.log(error);
            }
        });

        }
        function loadList(){
            $.ajax({
                type:"GET",
                url: "https://localhost:7165/Mission/listSP",
                dataType: "html",
                success: function(data){
                    $("#mission-list").html("");
                    $("#mission-list").html(data);
                },
                error: function(xhr, status, error){
                    console.log(error);
                }
            })
        }
    </script>
